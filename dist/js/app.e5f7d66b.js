(function(e){function n(n){for(var c,a,s=n[0],i=n[1],u=n[2],d=0,f=[];d<s.length;d++)a=s[d],Object.prototype.hasOwnProperty.call(o,a)&&o[a]&&f.push(o[a][0]),o[a]=0;for(c in i)Object.prototype.hasOwnProperty.call(i,c)&&(e[c]=i[c]);l&&l(n);while(f.length)f.shift()();return r.push.apply(r,u||[]),t()}function t(){for(var e,n=0;n<r.length;n++){for(var t=r[n],c=!0,s=1;s<t.length;s++){var i=t[s];0!==o[i]&&(c=!1)}c&&(r.splice(n--,1),e=a(a.s=t[0]))}return e}var c={},o={app:0},r=[];function a(n){if(c[n])return c[n].exports;var t=c[n]={i:n,l:!1,exports:{}};return e[n].call(t.exports,t,t.exports,a),t.l=!0,t.exports}a.m=e,a.c=c,a.d=function(e,n,t){a.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,n){if(1&n&&(e=a(e)),8&n)return e;if(4&n&&"object"===typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(a.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var c in e)a.d(t,c,function(n){return e[n]}.bind(null,c));return t},a.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(n,"a",n),n},a.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},a.p="/webrtc-video/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],i=s.push.bind(s);s.push=n,s=s.slice();for(var u=0;u<s.length;u++)n(s[u]);var l=i;r.push([0,"chunk-vendors"]),t()})({0:function(e,n,t){e.exports=t("56d7")},"236b":function(e,n,t){},"56d7":function(e,n,t){"use strict";t.r(n);t("e260"),t("e6cf"),t("cca6"),t("a79d");var c=t("7a23"),o=t("cf05"),r=t.n(o),a={id:"app"},s=Object(c["d"])("img",{alt:"Bear logo",src:r.a},null,-1);function i(e,n){var t=Object(c["i"])("Webcam");return Object(c["e"])(),Object(c["c"])("div",a,[s,Object(c["d"])(t)])}var u=Object(c["m"])("data-v-63f6cbc2");Object(c["g"])("data-v-63f6cbc2");var l={class:"webcam"},d={class:"sending-webcam"},f=Object(c["d"])("h1",null,"Sending Webcam",-1),p=Object(c["d"])("video",{id:"sending-cam",autoplay:"true"},null,-1),b=Object(c["d"])("div",{class:"receiving-webcam"},[Object(c["d"])("h1",null,"Receiving Webcam"),Object(c["d"])("video",{id:"receiving-cam",autoplay:"true"})],-1);Object(c["f"])();var g=u((function(e,n){return Object(c["e"])(),Object(c["c"])("div",l,[Object(c["d"])("div",d,[f,p,Object(c["d"])("button",{onClick:n[1]||(n[1]=function(n){return e.startWebcam()})},"Start"),Object(c["d"])("button",{onClick:n[2]||(n[2]=function(n){return e.getConnectedUsers()})},"GetUsers"),Object(c["l"])(Object(c["d"])("select",{"onUpdate:modelValue":n[3]||(n[3]=function(n){return e.selected_user=n}),onChange:n[4]||(n[4]=function(n){return e.call(e.selected_user)}),class:"form-control",id:"users-list"},[(Object(c["e"])(!0),Object(c["c"])(c["a"],null,Object(c["h"])(e.connected_users,(function(e,n){return Object(c["e"])(),Object(c["c"])("option",{value:e,key:n},Object(c["j"])(e),9,["value"])})),128))],544),[[c["k"],e.selected_user]])]),b])})),h=(t("4160"),t("159b"),t("96cf"),t("1da1")),v={name:"Webcam",data:function(){return{connection:null,selectedSource:null,sources:null,stream:null,peerConnection:null,connected_users:null,selected_user:null,config:{iceServers:[{urls:["stun:stun.l.google.com:19302"]}]},constraints:{audio:!0,video:!0}}},mounted:function(){var e="mediaDevices"in navigator;e?this.getDevices().then(this.gotDevices).catch((function(){console.log("Error with get devices.")})):console.log("Camera cannot be accessed")},methods:{call:function(e){e&&this.sendMessage("call",e)},getDevices:function(){var e=Object(h["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",navigator.mediaDevices.enumerateDevices());case 1:case"end":return e.stop()}}),e)})));function n(){return e.apply(this,arguments)}return n}(),gotDevices:function(e){var n=this;if(this.sources=[],e.forEach((function(e){"videoinput"===e.kind&&n.sources.push(e)})),!this.sources.length)throw"There are no video sources found!";this.selectedSource||(this.selectedSource=this.sources[0])},getConnectedUsers:function(){this.connection?this.sendMessage("get_connected"):console.log("Please start streaming first (to be changed)")},startWebcam:function(){var e=Object(h["a"])(regeneratorRuntime.mark((function e(){var n,t=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.connection){e.next=3;break}return console.log("Webcam already started!"),e.abrupt("return");case 3:return e.prev=3,e.next=6,navigator.mediaDevices.getUserMedia(this.constraints);case 6:this.stream=e.sent,n=document.querySelector("#sending-cam"),n.srcObject=this.stream,e.next=14;break;case 11:e.prev=11,e.t0=e["catch"](3),console.log("Something went wrong: ",e.t0);case 14:console.log("Starting Connection to Websocket Server"),this.connection=new WebSocket("ws://localhost:8081/echo"),this.connection.onopen=function(e){console.log(e),t.sendMessage("connect"),console.log("Successfully connected to the echo websocket server!")},this.connection.onmessage=function(e){console.log(e.data);var n=JSON.parse(e.data);switch(n.message_type){case"connected_user":t.connected_users=n.data;break;case"ready_to_establish_connection":t.peerConnection=new RTCPeerConnection(t.config),t.stream.getTracks().forEach((function(e){return t.peerConnection.addTrack(e,t.stream)})),t.peerConnection.onicecandidate=function(e){e.candidate&&t.sendMessage("candidate",e.candidate)},t.peerConnection.createOffer().then((function(e){return t.peerConnection.setLocalDescription(e)})).then((function(){t.sendMessage("offer",t.peerConnection.localDescription)}));break;case"offer":console.log(n.data),t.peerConnection=new RTCPeerConnection(t.config),t.stream.getTracks().forEach((function(e){return t.peerConnection.addTrack(e,t.stream)})),t.peerConnection.setRemoteDescription(n.data).then((function(){return t.peerConnection.createAnswer()})).then((function(e){return t.peerConnection.setLocalDescription(e)})).then((function(){t.sendMessage("answer",t.peerConnection.localDescription)})),t.peerConnection.ontrack=function(e){var n=document.querySelector("#receiving-cam");n.srcObject=e.streams[0]},t.peerConnection.onicecandidate=function(e){e.candidate&&t.sendMessage("candidate",e.candidate)};break;case"answer":t.peerConnection.setRemoteDescription(n.data),t.peerConnection.ontrack=function(e){console.log("here!!!"),console.log(e);var n=document.querySelector("#receiving-cam");n.srcObject=e.streams[0]};break;case"candidate":t.peerConnection.addIceCandidate(new RTCIceCandidate(n.data));break}},this.connection.onclose=function(e){console.log(e),t.connection=null};case 19:case"end":return e.stop()}}),e,this,[[3,11]])})));function n(){return e.apply(this,arguments)}return n}(),sendMessage:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,t={message:e,data:n};this.connection.send(JSON.stringify(t))}}};t("853a");v.render=g,v.__scopeId="data-v-63f6cbc2";var m=v,O={name:"App",components:{Webcam:m},data:function(){return{connection:null}},methods:{}};t("64be");O.render=i;var j=O;Object(c["b"])(j).mount("#app")},"64be":function(e,n,t){"use strict";t("c894")},"853a":function(e,n,t){"use strict";t("236b")},c894:function(e,n,t){},cf05:function(e,n,t){e.exports=t.p+"img/logo.7294e4e6.png"}});
//# sourceMappingURL=app.e5f7d66b.js.map